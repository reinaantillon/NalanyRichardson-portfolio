---
title: "Synthetic Data Exploratory Analysis"
date: "2026-02-06"
output: html_document
---

```{r, include=FALSE, cache=FALSE}
knitr::read_chunk('edacode.R')
```

Load the packages.
```{r,packages, echo=FALSE,message=FALSE}
library(dplyr)
library(purrr)
library(lubridate)
library(ggplot2)
```

```{r} 
# Set a seed for reproducibility
set.seed(234)
# Define the number of observations (patients) to generate
n_patients <- 100

# Create an empty data frame with placeholders for variables
syn_dat <- data.frame(
  PatientID = numeric(n_patients),
  Age = numeric(n_patients),
  Gender = character(n_patients),
  TreatmentGroup = character(n_patients),
  EnrollmentDate = lubridate::as_date(character(n_patients)),
  BloodPressure = numeric(n_patients),
  Troponin = numeric(n_patients),
  AdverseEvent = integer(n_patients)
)

# Variable 1: Patient ID
syn_dat$PatientID <- 1:n_patients

# Variable 2: Age (numeric variable)
syn_dat$Age <- round(rnorm(n_patients, mean = 60, sd = 10), 1)

# Variable 3: Gender (categorical variable)
syn_dat$Gender <- purrr::map_chr(sample(c("Male", "Female"), n_patients, replace = TRUE), as.character)

# Variable 4: Treatment Group (categorical variable)
syn_dat$TreatmentGroup <- purrr::map_chr(sample(c("A", "B", "Placebo"), n_patients, replace = TRUE), as.character)

# Variable 5: Date of Enrollment (date variable)
syn_dat$EnrollmentDate <- lubridate::as_date(sample(seq(from = lubridate::as_date("2022-01-01"), to = lubridate::as_date("2022-12-31"), by = "days"), n_patients, replace = TRUE))

# Variable 6: Blood Pressure (numeric variable)
syn_dat$BloodPressure <- round(runif(n_patients, min = 90, max = 160), 1)

# Variable 7: Troponin level (numeric variable)
# Option 1: Troponin level is independent of treatment
#syn_dat$Troponin <- round(rnorm(n_patients, mean = 0.10, sd = 0.15), 1)

# Option 2: Troponin is dependent on treatment
syn_dat$Troponin[syn_dat$TreatmentGroup == "A"] <- pmax(round(rnorm(sum(syn_dat$TreatmentGroup == "A"), mean = 0.035, sd = 0.012), 3), 0.001)
syn_dat$Troponin[syn_dat$TreatmentGroup == "B"] <- pmax(round(rnorm(sum(syn_dat$TreatmentGroup == "B"), mean = 0.085, sd = 0.020), 3), 0.001)
syn_dat$Troponin[syn_dat$TreatmentGroup == "Placebo"] <- pmax(round(rnorm(sum(syn_dat$TreatmentGroup == "Placebo"), mean = 0.260, sd = 0.060), 3), 0.001)

# Variable 8: Adverse Event (binary variable, 0 = No, 1 = Yes)
# Option 1: Adverse events are independent of treatment
#syn_dat$AdverseEvent <- purrr::map_int(sample(0:1, n_patients, replace = TRUE, prob = c(0.8, 0.2)), as.integer)

# Option 2: Adverse events are influenced by treatment status
syn_dat$AdverseEvent[syn_dat$TreatmentGroup == "A"] <- purrr::map_int(sample(0:1, sum(syn_dat$TreatmentGroup == "A"), replace = TRUE, prob = c(0.5, 0.5)), as.integer)
syn_dat$AdverseEvent[syn_dat$TreatmentGroup == "B"] <- purrr::map_int(sample(0:1, sum(syn_dat$TreatmentGroup == "B"), replace = TRUE, prob = c(0.7, 0.3)), as.integer)
syn_dat$AdverseEvent[syn_dat$TreatmentGroup == "Placebo"] <- purrr::map_int(sample(0:1, sum(syn_dat$TreatmentGroup == "Placebo"), replace = TRUE, prob = c(0.9, 0.1)), as.integer)
```
```{r}
# Print the first few rows of the generated data
head(syn_dat)

# Save the simulated data to a CSV and Rds file
write.csv(syn_dat, "syn_dat.csv", row.names = FALSE)
# if we wanted an RDS version
#saveRDS(syn_dat, here("data","syn_dat.Rds"))
```

```{r}
# Grab summary of synthetic data
summary(syn_dat)
dplyr::glimpse(syn_dat)  
# Frequency table for adverse events stratified by treatment
table(syn_dat$AdverseEvent,syn_dat$TreatmentGroup)
```

```{r}
# Boxplot of Troponin levels by treatment group
ggplot(syn_dat, aes(x = TreatmentGroup, y = Troponin)) +
  geom_boxplot() +
  labs(title = "Troponin Levels by Treatment", x = "Treatment Group", y = "Troponin Level") +
  theme_bw()

# Save the plot to figure section under results!
ggsave(
  filename = "results/figures/troponin-levels-by-treatment.png",
  plot = last_plot(),
  width = 8,
  height = 5,
  dpi = 300
)
# There is a difference in troponin levels across treatment groups, 
# with the placebo group having higher levels on average, and treatment group A has the lowest levels, which 
# correlates with lower risk of adverse events such as heart attacks.
```

```{r}
# Perform ANOVA to test for differences in troponin levels across treatment groups
anova_result <- aov(Troponin ~ TreatmentGroup, data = syn_dat)
summary(anova_result)
# A significant p-value (p < 0.05) would indicate that there are significant differences in troponin levels 
# between at least two of the treatment groups. Our p-value is <2e-16, suggesting strong evidence for difference.
```

```{r}
# We can also use linear models with treatment group as a predictor of troponin levels, and so forth.
# Model 1: treatment only
m1 <- lm(Troponin ~ TreatmentGroup, data = syn_dat)
summary(m1)

# Model 2: add demographics + blood pressure
m2 <- lm(Troponin ~ TreatmentGroup + Age + Gender + BloodPressure, data = syn_dat)
summary(m2)

# Model 3: allow treatment effect to vary by blood pressure
m3 <- lm(Troponin ~ TreatmentGroup * BloodPressure + Age + Gender, data = syn_dat)
summary(m3)

# Compare fit
anova(m1, m2, m3)
AIC(m1, m2, m3)
# Then we can make a combined report file for storing summmaries of our models.
# Save model summaries to a text file
install.packages("here") # if not already installed
library(here)
capture.output(
  "=== m1: Troponin ~ TreatmentGroup ===",
  summary(m1),
  "",
  "=== m2: Troponin ~ TreatmentGroup + Age + Gender + BloodPressure ===",
  summary(m2),
  "",
  "=== m3: Troponin ~ TreatmentGroup * BloodPressure + Age + Gender ===",
  summary(m3),
  file = here("results", "output", "lm_models_combined_summary.txt")
)
```
Across models, Treatment group was the main predictor of troponin levels, with Age and Blood Pressure also contributing in more complex models.
Group B tended to trend higher, with 0.054 ng/mL higher troponin, and Placebo was 0.234 ng/mL higher comparatively.
This means that those taking the placebo have a higher risk of heart attack or injury.
Note: This is a simulated dataset for educational purposes only and does not represent real patient data.
Chatgpt-5 mini was used to help generate this code within Positron. All text descriptions are my own.